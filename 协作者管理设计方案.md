# å¤šå®å®ç®¡ç†ä¸‹çš„åä½œè€…ç®¡ç†æ–¹æ¡ˆ

## 1. æ ¸å¿ƒæ¦‚å¿µ

### 1.1 æ•°æ®å…³ç³»ç»“æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    User (ç”¨æˆ·)                   â”‚
â”‚   â€¢ openid, nickName, avatarUrl, defaultBabyId  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†‘ â”‚ â†“
        å¯ä»¥åä½œå¤šä¸ªå®å® â”‚ å¯ä»¥æ‹¥æœ‰å¤šä¸ªå®å®
                    â”‚ â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚           â”‚               â”‚
        â†“           â†“               â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Baby1   â”‚ â”‚ Baby2   â”‚   â”‚ Baby3 (own)  â”‚
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚           â”‚
    â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”´â”€â”€â”€â”€â”€â”€â”
    â”‚           â”‚ â”‚         â”‚
    â†“           â†“ â†“         â†“
  [åä½œè€…]    [åä½œè€…]   [åä½œè€…]
  â€¢ user2      â€¢ user3    â€¢ user2
    admin        viewer     editor
  â€¢ user3
    editor
```

### 1.2 ä¸‰ä¸ªæ ¸å¿ƒè¡¨å…³ç³»

| è¡¨ | ä½œç”¨ | å…³é”®å­—æ®µ |
|---|------|---------|
| `babies` | å®å®æ¡£æ¡ˆ | babyId, creatorId(å®å®åˆ›å»ºè€…), name |
| `baby_collaborators` | å®å®-åä½œè€…å…³ç³» | babyId, openid, role, accessType, expiresAt |
| `baby_invitations` | é‚€è¯·ç®¡ç† | babyId, creatorOpenid, token, shortCode, expiresAt |

## 2. åä½œè€…æƒé™ä½“ç³»

### 2.1 è§’è‰²å®šä¹‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Admin (ç®¡ç†å‘˜)                        â”‚
â”‚  â€¢ å®Œå…¨æ§åˆ¶å®å®æ•°æ®                                      â”‚
â”‚  â€¢ å¯é‚€è¯·/ç§»é™¤åä½œè€…                                     â”‚
â”‚  â€¢ å¯æ›´æ–°åä½œè€…è§’è‰²                                      â”‚
â”‚  â€¢ å¯ä¿®æ”¹å®å®æ‰€æœ‰ä¿¡æ¯                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â†‘
                    å®å®åˆ›å»ºè€…
                    (é»˜è®¤æƒé™)

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Editor (ç¼–è¾‘è€…)              â”‚
â”‚  âœ… æŸ¥çœ‹å®å®æ•°æ®                      â”‚
â”‚  âœ… æ·»åŠ /ä¿®æ”¹è®°å½• (å–‚å…»ã€ç¡çœ ç­‰)      â”‚
â”‚  âœ… é‚€è¯·åä½œè€…                        â”‚
â”‚  âŒ åˆ é™¤å®å®/ä¿®æ”¹åŸºæœ¬ä¿¡æ¯             â”‚
â”‚  âŒ ç§»é™¤åä½œè€…/ä¿®æ”¹è§’è‰²              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Viewer (æŸ¥çœ‹è€…)              â”‚
â”‚  âœ… æŸ¥çœ‹å®å®æ•°æ®                      â”‚
â”‚  âœ… æŸ¥çœ‹æ‰€æœ‰è®°å½•                      â”‚
â”‚  âŒ æ·»åŠ /ä¿®æ”¹è®°å½•                     â”‚
â”‚  âŒ é‚€è¯·åä½œè€…                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 æƒé™æ£€æŸ¥çŸ©é˜µ

```typescript
interface PermissionRule {
  action: string;
  requiredRole: 'admin' | 'editor' | 'viewer';
  requiredAccessType?: 'permanent' | 'temporary';
}

const PERMISSION_RULES: PermissionRule[] = [
  // æŸ¥çœ‹ç±»æ“ä½œ
  { action: 'viewBaby', requiredRole: 'viewer' },
  { action: 'viewRecords', requiredRole: 'viewer' },
  { action: 'viewCollaborators', requiredRole: 'viewer' },

  // ç¼–è¾‘ç±»æ“ä½œ
  { action: 'addRecord', requiredRole: 'editor' },
  { action: 'editRecord', requiredRole: 'editor' },
  { action: 'deleteRecord', requiredRole: 'editor' },

  // ç®¡ç†ç±»æ“ä½œ
  { action: 'editBaby', requiredRole: 'admin' },
  { action: 'deleteBaby', requiredRole: 'admin' },
  { action: 'inviteCollaborator', requiredRole: 'admin' },
  { action: 'removeCollaborator', requiredRole: 'admin' },
  { action: 'updateCollaboratorRole', requiredRole: 'admin' },
];
```

## 3. å‰ç«¯å±•ç¤ºè®¾è®¡

### 3.1 å®å®åˆ—è¡¨å¡ç‰‡ - åä½œè€…å±•ç¤º

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  [å¤´åƒ] å°æ˜                  [é»˜è®¤æ ‡ç­¾]     â”‚
â”‚        3ä¸ªæœˆå¤§                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ‘¥ åä½œè€… (2äºº)                             â”‚  â† ç‚¹å‡»æŸ¥çœ‹è¯¦æƒ…
â”‚  â”œâ”€ å¦ˆå¦ˆ (admin)                            â”‚
â”‚  â””â”€ çˆ¸çˆ¸ (editor)                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ [é‚€è¯·åä½œ] [è®¾ä¸ºé»˜è®¤] [ç¼–è¾‘] [åˆ é™¤]           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**è®¾è®¡è¯´æ˜**:
- æ˜¾ç¤ºåä½œè€…æ€»æ•°
- åˆ—è¡¨å½¢å¼å±•ç¤ºåä½œè€… (æœ€å¤šæ˜¾ç¤º3ä¸ªï¼Œè¶…è¿‡åˆ™æ˜¾ç¤º"+N")
- æ¯ä¸ªåä½œè€…æ˜¾ç¤ºï¼šå¤´åƒã€æ˜µç§°ã€è§’è‰²æ ‡ç­¾
- ç‚¹å‡»å¡ç‰‡å¯å±•å¼€æŸ¥çœ‹å…¨éƒ¨åä½œè€…

### 3.2 æ–°é¡µé¢ï¼šåä½œè€…ç®¡ç†é¡µé¢ (`pages/baby/collaborators/collaborators.vue`)

```
é¡µé¢å¸ƒå±€ï¼š

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â† å°æ˜çš„åä½œè€…                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  [æœç´¢æ¡† - æœç´¢åä½œè€…åç§°]                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                    â”‚
â”‚  ğŸ‘¤ å¦ˆå¦ˆ                                  [ç§»é™¤]    â”‚
â”‚     admin Â· åˆ›å»ºè€… Â· æ°¸ä¹…æƒé™                       â”‚
â”‚                                                    â”‚
â”‚  ğŸ‘¤ çˆ¸çˆ¸                                  [å˜æ›´ âŒ„]  â”‚
â”‚     editor Â· æœ‰æ•ˆæœŸè‡³ 2025-12-31                   â”‚
â”‚     æƒé™: æŸ¥çœ‹ã€æ·»åŠ /ä¿®æ”¹è®°å½•ã€é‚€è¯·åä½œè€…           â”‚
â”‚                                                    â”‚
â”‚  ğŸ‘¤ å¥¶å¥¶                                  [å˜æ›´ âŒ„]  â”‚
â”‚     viewer Â· æœ‰æ•ˆæœŸè‡³ 2025-06-30                   â”‚
â”‚     æƒé™: ä»…æŸ¥çœ‹æ•°æ®                               â”‚
â”‚                                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ [é‚€è¯·æ–°çš„åä½œè€…]                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.3 è§’è‰²å˜æ›´å¼¹çª—

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å˜æ›´ çˆ¸çˆ¸ çš„æƒé™                 â”‚ âœ•
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                 â”‚
â”‚  é€‰æ‹©æ–°è§’è‰²:                      â”‚
â”‚  â—‹ Admin (ç®¡ç†å‘˜)               â”‚
â”‚  â— Editor (ç¼–è¾‘è€…) å½“å‰          â”‚
â”‚  â—‹ Viewer (æŸ¥çœ‹è€…)              â”‚
â”‚                                 â”‚
â”‚  æƒé™æœ‰æ•ˆæœŸ:                      â”‚
â”‚  â—‹ æ°¸ä¹…æœ‰æ•ˆ                      â”‚
â”‚  â— æœ‰æ•ˆæœŸè‡³: [2025-12-31]       â”‚
â”‚                                 â”‚
â”‚ [å–æ¶ˆ]        [ç¡®å®šå˜æ›´]         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## 4. é‚€è¯·æµç¨‹ï¼ˆå®Œæ•´ï¼‰

### 4.1 å‘èµ·é‚€è¯·æµç¨‹

```
ç”¨æˆ·ç‚¹å‡»"é‚€è¯·åä½œè€…"
    â†“
GET /babies/{babyId}/collaborators
(æŸ¥çœ‹ç°æœ‰åä½œè€…ï¼Œæ˜¾ç¤ºå·²æœ‰åä½œè€…)
    â†“
[é€‰æ‹©æ–°åä½œè€…ä¿¡æ¯]
    â”œâ”€ è¾“å…¥/é€‰æ‹© openid æˆ–æ‰‹æœºå·
    â”œâ”€ é€‰æ‹©è§’è‰² (admin/editor/viewer)
    â””â”€ é€‰æ‹©æœ‰æ•ˆæœŸ (æ°¸ä¹…/æ—¶é—´é™åˆ¶)
    â†“
POST /babies/{babyId}/collaborators/invite
{
  "targetOpenid": "user2's_openid",
  "role": "editor",
  "expiresAt": 1735689600,
  "accessType": "temporary"
}
    â†“
å“åº”: {
  "shortCode": "AB12CD",
  "token": "abc123def456...",
  "qrCodeUrl": "https://...",
  "expiresAt": 1735689600
}
    â†“
[æ˜¾ç¤ºäºŒç»´ç  + Token]
ç”¨æˆ·åˆ†äº«ç»™åä½œè€…
```

### 4.2 åŠ å…¥æµç¨‹

**æ–¹å¼ä¸€ï¼šæ‰«æäºŒç»´ç  (æ¨è)**
```
æ‰«æäºŒç»´ç  â†’ pages/baby/join/join?scene=c=AB12CD
    â†“
GET /invitations/code/AB12CD
    â†“
æ˜¾ç¤º: "å¦ˆå¦ˆé‚€è¯·ä½ ä½œä¸ºEditoråŠ å…¥å°æ˜çš„æˆé•¿è®°å½•ï¼Œæœ‰æ•ˆæœŸè‡³2025-12-31"
    â†“
ç”¨æˆ·ç‚¹å‡»[ç¡®è®¤åŠ å…¥]
    â†“
POST /babies/join
{
  "babyId": "baby_123",
  "token": "abc123def456...",
  "shortCode": "AB12CD"
}
    â†“
æˆåŠŸ â†’ è¿”å›é¦–é¡µï¼Œæ˜¾ç¤ºè¯¥å®å®
```

**æ–¹å¼äºŒï¼šToken åˆ†äº« (å¤‡é€‰)**
```
åˆ†äº«é“¾æ¥: pages/baby/join/join?babyId=baby_123&token=abc123def456...
    â†“
(ç›¸åŒçš„ç¡®è®¤æµç¨‹)
```

## 5. æ•°æ®æµè®¾è®¡

### 5.1 å‰ç«¯çŠ¶æ€ç®¡ç†

```typescript
// src/store/baby.ts - å¢å¼ºçš„å®å®çŠ¶æ€ç®¡ç†

interface BabyWithCollaborators extends BabyProfile {
  // æ–°å¢å­—æ®µï¼šåä½œè€…ä¿¡æ¯
  collaborators?: BabyCollaborator[];
  myRole?: 'admin' | 'editor' | 'viewer';
  myAccessType?: 'permanent' | 'temporary';
  myExpiresAt?: number;
}

interface BabyCollaborator {
  openid: string;
  nickName: string;
  avatarUrl?: string;
  role: 'admin' | 'editor' | 'viewer';
  accessType: 'permanent' | 'temporary';
  expiresAt?: number;
  joinedAt: number;
  isCreator: boolean; // æ˜¯å¦ä¸ºå®å®åˆ›å»ºè€…
}

interface BabyStore {
  // ç°æœ‰çŠ¶æ€
  currentBabyId: Ref<string>;
  babyList: Ref<BabyProfile[]>;

  // æ–°å¢çŠ¶æ€
  collaboratorsMap: Ref<Map<string, BabyCollaborator[]>>;
  myPermissionsMap: Ref<Map<string, MyPermission>>;
}

interface MyPermission {
  babyId: string;
  role: 'admin' | 'editor' | 'viewer';
  accessType: 'permanent' | 'temporary';
  expiresAt?: number;
  isExpired: boolean;
}
```

### 5.2 æƒé™æ£€æŸ¥å·¥å…·

```typescript
// src/utils/permission.ts - æ–°å¢æƒé™å·¥å…·

export function canViewBaby(babyId: string, permission?: MyPermission): boolean {
  if (!permission) return false;
  if (permission.isExpired) return false;
  return true; // viewer/editor/adminéƒ½èƒ½æŸ¥çœ‹
}

export function canEditBaby(babyId: string, permission?: MyPermission): boolean {
  if (!permission) return false;
  if (permission.isExpired) return false;
  return permission.role === 'admin' || permission.role === 'editor';
}

export function canManageBaby(babyId: string, permission?: MyPermission): boolean {
  if (!permission) return false;
  if (permission.isExpired) return false;
  return permission.role === 'admin';
}

export function canManageCollaborators(
  babyId: string,
  permission?: MyPermission
): boolean {
  return canManageBaby(babyId, permission);
}

export function getPermissionLabel(
  role: 'admin' | 'editor' | 'viewer'
): string {
  const labels: Record<string, string> = {
    admin: 'ç®¡ç†å‘˜',
    editor: 'ç¼–è¾‘è€…',
    viewer: 'æŸ¥çœ‹è€…',
  };
  return labels[role] || role;
}
```

## 6. API ç«¯ç‚¹è®¾è®¡

### 6.1 æ–°å¢ API ç«¯ç‚¹

| æ–¹æ³• | è·¯å¾„ | è¯´æ˜ | æƒé™ |
|------|------|------|------|
| GET | `/babies/{babyId}/collaborators` | è·å–åä½œè€…åˆ—è¡¨ | viewer+ |
| POST | `/babies/{babyId}/collaborators/invite` | ç”Ÿæˆé‚€è¯· | admin+ |
| DELETE | `/babies/{babyId}/collaborators/{openid}` | ç§»é™¤åä½œè€… | admin+ |
| PUT | `/babies/{babyId}/collaborators/{openid}/role` | æ›´æ–°è§’è‰² | admin+ |
| GET | `/invitations/code/{shortCode}` | è·å–é‚€è¯·è¯¦æƒ… | å…¬å¼€ |
| POST | `/babies/join` | ç¡®è®¤åŠ å…¥ | è®¤è¯ç”¨æˆ· |

### 6.2 å‰ç«¯ API æ¥å£

```typescript
// src/api/collaborator.ts - æ–°å¢åä½œè€…API

export interface BabyCollaboratorResponse {
  openid: string;
  nickName: string;
  avatarUrl?: string;
  role: 'admin' | 'editor' | 'viewer';
  accessType: 'permanent' | 'temporary';
  expiresAt?: number;
  joinedAt: number;
  isCreator: boolean;
}

export interface InviteCollaboratorRequest {
  targetOpenid?: string; // å¦‚æœå·²çŸ¥openid
  targetPhone?: string;  // å¦‚æœé€šè¿‡æ‰‹æœºå·
  role: 'admin' | 'editor' | 'viewer';
  expiresAt?: number;
  accessType: 'permanent' | 'temporary';
}

export interface InviteCollaboratorResponse {
  babyId: string;
  shortCode: string;
  token: string;
  qrCodeUrl: string;
  expiresAt?: number;
}

// è·å–åä½œè€…åˆ—è¡¨
export async function apiFetchCollaborators(
  babyId: string
): Promise<BabyCollaboratorResponse[]> {
  const response = await get<BabyCollaboratorResponse[]>(
    `/babies/${babyId}/collaborators`
  );
  return response.data || [];
}

// é‚€è¯·åä½œè€…
export async function apiInviteCollaborator(
  babyId: string,
  data: InviteCollaboratorRequest
): Promise<InviteCollaboratorResponse> {
  const response = await post<InviteCollaboratorResponse>(
    `/babies/${babyId}/collaborators/invite`,
    data
  );
  return response.data;
}

// ç§»é™¤åä½œè€…
export async function apiRemoveCollaborator(
  babyId: string,
  openid: string
): Promise<void> {
  const response = await del(
    `/babies/${babyId}/collaborators/${openid}`
  );
  if (response.code !== 0) {
    throw new Error('ç§»é™¤åä½œè€…å¤±è´¥');
  }
}

// æ›´æ–°åä½œè€…è§’è‰²
export async function apiUpdateCollaboratorRole(
  babyId: string,
  openid: string,
  role: 'admin' | 'editor' | 'viewer',
  expiresAt?: number
): Promise<void> {
  const response = await put(
    `/babies/${babyId}/collaborators/${openid}/role`,
    { role, expiresAt }
  );
  if (response.code !== 0) {
    throw new Error('æ›´æ–°æƒé™å¤±è´¥');
  }
}
```

## 7. å®ç°è®¡åˆ’

### ç¬¬ä¸€é˜¶æ®µï¼šåç«¯æ”¯æŒï¼ˆå·²å­˜åœ¨ï¼Œæ£€æŸ¥APIï¼‰
- âœ… BabyCollaborator entity
- âœ… BabyInvitation entity
- âœ… åä½œè€…ç›¸å…³APIç«¯ç‚¹
- æ£€æŸ¥é¡¹ï¼šé‚€è¯·ç«¯ç‚¹å“åº”æ ¼å¼ã€æƒé™éªŒè¯

### ç¬¬äºŒé˜¶æ®µï¼šå‰ç«¯åŸºç¡€è®¾æ–½
- [ ] åˆ›å»º `src/api/collaborator.ts`
- [ ] åˆ›å»º `src/utils/permission.ts`
- [ ] æ›´æ–° `src/store/baby.ts` æ·»åŠ åä½œè€…çŠ¶æ€
- [ ] åˆ›å»º `src/types/collaborator.ts` ç±»å‹å®šä¹‰

### ç¬¬ä¸‰é˜¶æ®µï¼šå‰ç«¯UIå®ç°
- [ ] æ›´æ–°å®å®åˆ—è¡¨å¡ç‰‡ï¼Œæ˜¾ç¤ºåä½œè€…æ¦‚è§ˆ
- [ ] åˆ›å»ºåä½œè€…ç®¡ç†é¡µé¢ (`pages/baby/collaborators/collaborators.vue`)
- [ ] åˆ›å»ºè§’è‰²å˜æ›´å¼¹çª—ç»„ä»¶
- [ ] å®Œå–„é‚€è¯·åŠ å…¥æµç¨‹ (`pages/baby/join/join.vue`)

### ç¬¬å››é˜¶æ®µï¼šåŠŸèƒ½æ•´åˆ
- [ ] å®å®åˆ—è¡¨é¡µé¢é›†æˆåä½œè€…å…¥å£
- [ ] æƒé™éªŒè¯é›†æˆåˆ°å„åŠŸèƒ½é¡µé¢
- [ ] æµ‹è¯•æƒé™æ£€æŸ¥æµç¨‹
- [ ] å¤„ç†æƒé™è¿‡æœŸæƒ…å†µ

## 8. ç‰¹æ®Šåœºæ™¯å¤„ç†

### 8.1 æƒé™è¿‡æœŸå¤„ç†

```typescript
// ç”¨æˆ·è®¿é—®æ—¶æ£€æŸ¥æƒé™æ˜¯å¦è¿‡æœŸ
if (myPermission.expiresAt && Date.now() > myPermission.expiresAt) {
  // æƒé™å·²è¿‡æœŸï¼Œæ˜¾ç¤ºæç¤º
  showToast('æ‚¨å¯¹æ­¤å®å®çš„æƒé™å·²è¿‡æœŸï¼Œè¯·é‡æ–°ç”³è¯·');
  // ä»å¯è®¿é—®åˆ—è¡¨ç§»é™¤è¯¥å®å®
  removeBabyFromList(babyId);
}
```

### 8.2 åä½œè€…å†²çªå¤„ç†

```typescript
// åŒä¸€ä¸ªäººè¢«é‚€è¯·å¤šæ¬¡
if (existingCollaborator) {
  // æ›´æ–°ç°æœ‰è®°å½•ï¼Œè€Œéåˆ›å»ºæ–°è®°å½•
  updateCollaborator(existingCollaborator.id, newPermission);
} else {
  // åˆ›å»ºæ–°è®°å½•
  createCollaborator(newPermission);
}
```

### 8.3 å®å®åˆ é™¤æ—¶çš„åä½œè€…å¤„ç†

```typescript
// å½“adminåˆ é™¤å®å®æ—¶
DELETE /babies/{babyId}
  â””â”€ çº§è”åˆ é™¤æ‰€æœ‰baby_collaboratorsè®°å½•
  â””â”€ çº§è”åˆ é™¤æ‰€æœ‰baby_invitationsè®°å½•
  â””â”€ å…¶ä»–åä½œè€…ä¼šæ”¶åˆ°é€šçŸ¥(å¯é€‰)
```

## 9. ç”¨æˆ·ä½“éªŒä¼˜åŒ–

### 9.1 å¿«é€Ÿé‚€è¯·æµç¨‹
```
1. å®å®åˆ—è¡¨é¡µ â†’ [é‚€è¯·åä½œè€…]
2. é€‰æ‹©è§’è‰² + æœ‰æ•ˆæœŸ
3. ç”ŸæˆäºŒç»´ç 
4. ä¸€é”®åˆ†äº«ç»™è”ç³»äºº
5. åä½œè€…æ‰«ç åŠ å…¥
```

### 9.2 æƒé™é€æ˜åŒ–
```
- æ¯ä¸ªåä½œè€…å¡ç‰‡æ˜¾ç¤ºå…·ä½“æƒé™åˆ—è¡¨
- æƒé™å˜æ›´æ—¶å³æ—¶æé†’
- æƒé™è¿‡æœŸå‰7å¤©æé†’ç»­æœŸ
```

### 9.3 å®‰å…¨æç¤º
```
- ç§»é™¤åä½œè€…å‰è¯¢é—®ç¡®è®¤
- é™çº§æƒé™æ—¶æ˜¾ç¤ºå°†å¤±å»çš„æ“ä½œ
- é‚€è¯·é“¾æ¥æœ‰æ•ˆæœŸæ˜¾ç¤º
```

## 10. åç»­æ‰©å±•

### 10.1 å¯è€ƒè™‘çš„åŠŸèƒ½
- æ‰¹é‡é‚€è¯·å¤šä¸ªåä½œè€…
- åä½œè€…æƒé™é¢„è®¾æ¨¡æ¿
- é‚€è¯·å†å²è®°å½•
- åä½œè€…æ´»è·ƒåº¦ç»Ÿè®¡
- æ“ä½œå®¡è®¡æ—¥å¿—

### 10.2 å¯è€ƒè™‘çš„ä¼˜åŒ–
- ä½¿ç”¨æœ¬åœ°åŒ–é€šè®¯å½•å¿«é€Ÿé€‰æ‹©
- æ”¯æŒé€šè¿‡å¾®ä¿¡å¥½å‹æ¨è
- æƒé™è¿‡æœŸè‡ªåŠ¨ç»­æœŸæé†’
- æ”¯æŒä¸´æ—¶æƒé™(å¦‚è®¿å®¢æ¨¡å¼)

